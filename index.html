<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mindmap</title>
    <!-- Polyfills for browser compatibility -->
    <script src="js/polyfills.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- 모바일 햄버거 메뉴 -->
        <button class="mobile-menu-toggle" onclick="toggleMobileSidebar()" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </button>
        
        <!-- 사이드바 -->
        <div class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h1 data-i18n="app.title">Mindmap</h1>
                <button class="theme-toggle" onclick="toggleDarkMode()" title="Toggle Dark Mode" data-i18n-title="theme.toggle">
                    <span id="themeIcon">🌙</span>
                </button>
                <button class="language-toggle" onclick="toggleLanguage()" title="Switch Language">
                    <span id="langText">EN</span>
                </button>
                <button class="sidebar-close-btn" onclick="toggleMobileSidebar()" aria-label="Close sidebar">
                    <span>×</span>
                </button>
                <button class="sidebar-toggle-btn" onclick="toggleSidebar()" aria-label="Toggle sidebar">
                    <span class="toggle-arrow">◀</span>
                </button>
            </div>
            
            <div class="sidebar-fixed-actions">
                <!-- Search -->
                <div class="section" style="margin-bottom: 12px;">
                    <div class="search-container">
                        <input type="text" id="searchInput" class="search-input" data-i18n-placeholder="action.searchPlaceholder" placeholder="노드 검색..." onkeyup="handleSearchInput(event)">
                        <button class="btn btn-icon" onclick="clearSearch()" title="Clear search" data-i18n-title="action.clearSearch" style="padding: 4px 8px;">
                            <span style="font-size: 18px;">×</span>
                        </button>
                    </div>
                    <div id="searchResults" class="search-results" style="display: none;">
                        <button class="btn btn-secondary" onclick="navigateSearch(-1)" data-i18n="action.prevResult">이전</button>
                        <span id="searchResultText" style="padding: 0 8px; font-size: 13px;"></span>
                        <button class="btn btn-secondary" onclick="navigateSearch(1)" data-i18n="action.nextResult">다음</button>
                    </div>
                </div>
                
                <!-- New Page Button -->
                <div class="section" style="margin-bottom: 12px;">
                    <button class="btn btn-primary" onclick="createNewPage()" data-i18n="action.newPage">New Page</button>
                </div>
                
                <!-- Quick Actions -->
                <div class="section" style="margin-bottom: 12px;">
                    <!-- Quick Actions 문구 삭제 -->
                    <button class="btn btn-primary" onclick="addRandomNode()" data-i18n="action.addNode">Add Node (Random)</button>
                    
                    <div class="btn-group icon-buttons">
                        <button class="btn btn-icon" onclick="undo()" data-i18n="action.undo" title="Undo">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
                        </button>
                        <button class="btn btn-icon" onclick="redo()" data-i18n="action.redo" title="Redo">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"/></svg>
                        </button>
                        <button class="btn btn-icon" onclick="fitToScreen()" data-i18n="action.fit" title="Fit to Screen">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
                        </button>
                        <button class="btn btn-icon" id="snapToggle" onclick="toggleSnapToGrid()" data-i18n="action.snap" title="Snap to Grid">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="snapIcon"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                        </button>
                    </div>
                    
                    <div class="btn-group icon-buttons" style="margin-top: 8px;">
                        <button class="btn btn-icon" onclick="saveMindmap()" data-i18n="file.save" title="Save to LocalStorage">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                        </button>
                        <button class="btn btn-icon" onclick="importJSON()" data-i18n="file.import" title="Import JSON Files">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        </button>
                        <button class="btn btn-icon" onclick="openImportURLModal()" data-i18n="file.importURL" title="Import from URL">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                        </button>
                        <button class="btn btn-icon" onclick="autoSaveJSON()" data-i18n="file.export" title="Export JSON File">
                            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                        </button>
                    </div>
                </div>
            </div>
            
            <div class="sidebar-content">
            <!-- Controls -->
            <div class="section">
                <div class="section-title">
                    <span data-i18n="section.controls">Controls</span>
                </div>
                
                <!-- 데스크톱 컨트롤 -->
                <div class="controls-text desktop-controls">
                    <strong style="display: block; margin-top: 8px; margin-bottom: 4px;" data-i18n="controls.category.basic">기본 조작</strong>
                    <ul>
                        <li data-i18n="controls.desktop.create">더블클릭 (빈 공간) → 노드 생성</li>
                        <li data-i18n="controls.desktop.edit">더블클릭 (노드) → 노드 편집</li>
                        <li data-i18n="controls.desktop.move">좌클릭 드래그 (노드) → 이동</li>
                        <li data-i18n="controls.desktop.connect">우클릭 드래그 (노드) → 연결선 생성</li>
                        <li data-i18n="controls.desktop.context">우클릭 (노드) → 메뉴</li>
                        <li data-i18n="controls.desktop.pan">휠 클릭 드래그 → 화면 이동</li>
                        <li data-i18n="controls.desktop.zoom">휠 스크롤 → 확대/축소</li>
                    </ul>
                    <strong style="display: block; margin-top: 8px; margin-bottom: 4px;" data-i18n="controls.category.multiSelect">다중 선택</strong>
                    <ul>
                        <li data-i18n="controls.desktop.multiSelect">Shift + 드래그 → 영역 선택</li>
                        <li data-i18n="controls.desktop.multiSelectCtrl">Ctrl + 클릭 → 개별 선택/해제</li>
                        <li data-i18n="controls.desktop.selectAll">Ctrl + A → 전체 선택</li>
                        <li data-i18n="controls.desktop.escape">Esc → 선택 해제</li>
                    </ul>
                    <strong style="display: block; margin-top: 8px; margin-bottom: 4px;" data-i18n="controls.category.editing">편집</strong>
                    <ul>
                        <li data-i18n="controls.desktop.delete">Delete / Backspace → 선택 삭제</li>
                        <li data-i18n="controls.desktop.undo">Ctrl + Z → 실행취소</li>
                        <li data-i18n="controls.desktop.redo">Ctrl + Y (또는 Ctrl + Shift + Z) → 다시실행</li>
                    </ul>
                </div>
                
                <!-- 모바일/태블릿 컨트롤 -->
                <div class="controls-text mobile-controls">
                    <strong style="display: block; margin-top: 8px; margin-bottom: 4px;" data-i18n="controls.category.basic">기본 조작</strong>
                    <ul>
                        <li data-i18n="controls.mobile.create">더블탭 (빈 공간) → 노드 생성</li>
                        <li data-i18n="controls.mobile.edit">더블탭 (노드) → 노드 편집</li>
                        <li data-i18n="controls.mobile.move">드래그 (노드) → 이동</li>
                        <li data-i18n="controls.mobile.connect">길게 누른 후 드래그 (노드) → 연결선 생성</li>
                        <li data-i18n="controls.mobile.pan">한 손가락 드래그 (빈 공간) → 화면 이동</li>
                        <li data-i18n="controls.mobile.zoom">두 손가락 핀치 → 확대/축소</li>
                    </ul>
                    <strong style="display: block; margin-top: 8px; margin-bottom: 4px;" data-i18n="controls.category.multiSelect">다중 선택</strong>
                    <ul>
                        <li data-i18n="controls.mobile.multiSelect">두 손가락 드래그 (빈 공간) → 영역 선택</li>
                        <li data-i18n="controls.mobile.multiSelectToggle">탭 (노드, 선택 모드) → 개별 선택/해제</li>
                        <li data-i18n="controls.mobile.clearSelection">탭 (빈 공간, 선택 모드) → 선택 해제</li>
                    </ul>
                </div>
            </div>

            <!-- Recent Files -->
            <div class="section">
                <div class="section-title">
                    <span data-i18n="file.recent">최근 파일</span>
                </div>
                <div id="recentItems" class="recent-items">
                    <div class="recent-items-empty" data-i18n="file.noRecent">저장된 파일이 없습니다</div>
                </div>
            </div>
            </div>
            

            
            <!-- 사이드바 닫혔을 때 보이는 빠른 액션 바 -->
            <div class="quick-action-bar">
                <button class="quick-action-btn" onclick="toggleSidebar()" title="Open sidebar">
                    <span class="toggle-arrow">▶</span>
                </button>
                <button class="quick-action-btn" onclick="addRandomNode()" title="Add Node">
                    +
                </button>
                <button class="quick-action-btn" onclick="undo()" title="Undo">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 7v6h6"/><path d="M21 17a9 9 0 0 0-9-9 9 9 0 0 0-6 2.3L3 13"/></svg>
                </button>
                <button class="quick-action-btn" onclick="redo()" title="Redo">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 7v6h-6"/><path d="M3 17a9 9 0 0 1 9-9 9 9 0 0 1 6 2.3l3 2.7"/></svg>
                </button>
                <button class="quick-action-btn" onclick="fitToScreen()" title="Fit to Screen">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 3H5a2 2 0 0 0-2 2v3m18 0V5a2 2 0 0 0-2-2h-3m0 18h3a2 2 0 0 0 2-2v-3M3 16v3a2 2 0 0 0 2 2h3"/></svg>
                </button>
                <button class="quick-action-btn" id="snapToggleCollapsed" onclick="toggleSnapToGrid()" title="Snap to Grid">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" id="snapIconCollapsed"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
                </button>
                <button class="quick-action-btn" onclick="saveMindmap()" title="Save to LocalStorage">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
                </button>
                <button class="quick-action-btn" onclick="importJSON()" title="Import JSON Files">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                </button>
                <button class="quick-action-btn" onclick="openImportURLModal()" title="Import from URL">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>
                </button>
                <button class="quick-action-btn" onclick="autoSaveJSON()" title="Export JSON File">
                    <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
                </button>
            </div>
        </div>        <!-- 메인 영역 -->
        <div class="main-area">
            <canvas id="canvas"></canvas>
            <div class="status" id="status">Create nodes and connect ideas</div>
        </div>
    </div>

    <!-- 컨텍스트 메뉴 -->
    <div id="contextMenu" class="context-menu">
        <div class="context-menu-item" onclick="editNode()" data-i18n="context.edit">Edit</div>
        <div class="context-menu-item" onclick="duplicateNode()">Duplicate</div>
        <div class="context-menu-item" id="deleteNodeItem" onclick="deleteNode()" data-i18n="context.delete">Delete</div>
        <div class="context-menu-item" onclick="deleteConnection()" id="deleteConnectionItem" style="display: none;" data-i18n="context.deleteConnection">🔗 Delete Connection</div>
    </div>
    
    <!-- 연결선 전용 컨텍스트 메뉴 -->
    <div id="connectionContextMenu" class="context-menu">
        <div class="context-menu-item" onclick="deleteConnectionOnly()" data-i18n="context.deleteConnection">🔗 Delete Connection</div>
    </div>
    
    <!-- 파일 항목 메뉴 -->
    <div id="fileItemMenu" class="context-menu">
        <div class="context-menu-item" onclick="toggleFileFavorite()">즐겨찾기</div>
        <div class="context-menu-item" onclick="renameFileItem()">이름 변경</div>
        <div class="context-menu-item" onclick="deleteFileItem()">삭제</div>
    </div>

    <!-- 편집 모달 -->
    <div id="editModal" class="modal" onclick="handleModalBackdropClick(event, 'editModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-title" data-i18n="modal.edit.title">Edit Node</div>
            <form onsubmit="saveNodeEdit(event)">
                <div class="form-group">
                    <label data-i18n="modal.edit.nodeTitle">Title</label>
                    <input type="text" id="editTitle" placeholder="Enter title..." required maxlength="100">
                </div>
                <div class="form-group">
                    <label data-i18n="modal.edit.content">Content</label>
                    <textarea id="editContent" placeholder="최대 500자까지 입력 가능합니다" maxlength="500"></textarea>
                </div>
                <div class="form-group">
                    <label data-i18n="modal.edit.link">Link</label>
                    <input type="url" id="editLink" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label data-i18n="modal.edit.link2">Link 2</label>
                    <input type="url" id="editLink2" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label data-i18n="modal.edit.color">노드 색상</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="color" id="editColor" value="#ffffff" style="flex: 0 0 50px;">
                        <button type="button" class="btn btn-secondary" onclick="addColorToPalette('editColor')" data-i18n="palette.add" style="font-size: 11px; padding: 4px 8px;">★ 추가</button>
                    </div>
                    <div id="colorPalette" class="color-palette" style="margin-top: 8px;"></div>
                </div>
                <div class="form-group">
                    <label data-i18n="modal.edit.textColor">텍스트 색상</label>
                    <div style="display: flex; gap: 8px; align-items: center;">
                        <input type="color" id="editTextColor" value="#333333" style="flex: 0 0 50px;">
                        <button type="button" class="btn btn-secondary" onclick="addColorToPalette('editTextColor')" data-i18n="palette.add" style="font-size: 11px; padding: 4px 8px;">★ 추가</button>
                    </div>
                    <div id="textColorPalette" class="color-palette" style="margin-top: 8px;"></div>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()" data-i18n="modal.edit.cancel">Cancel</button>
                    <button type="submit" class="btn btn-primary" data-i18n="modal.edit.save">Save</button>
                </div>
                <div class="modal-buttons mobile-only-buttons">
                    <button type="button" class="btn btn-warning" onclick="deleteConnectionsFromModal()" id="deleteConnectionsBtn" style="display: none;" data-i18n="modal.edit.deleteConnections">Delete Connections</button>
                    <button type="button" class="btn btn-danger" onclick="deleteNodeFromModal()" id="deleteNodeBtn" data-i18n="modal.edit.deleteNode">Delete Node</button>
                </div>
            </form>
        </div>
    </div>

    <!-- AI 추천 정보 모달 -->
    <div id="recommendationsModal" class="modal" onclick="handleModalBackdropClick(event, 'recommendationsModal')">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header" style="margin-bottom: 24px;">
                <h2 data-i18n="ai.recommendations_title">AI 추천 정보</h2>
            </div>
            <div class="modal-body">
                <div id="recommendationsList" class="recommendations-list">
                    <!-- AI 추천 링크들이 동적으로 추가됩니다 -->
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeRecommendationsModal()" data-i18n="common.close">닫기</button>
            </div>
        </div>
    </div>

    <!-- URL 불러오기 모달 -->
    <div id="importURLModal" class="modal" onclick="handleModalBackdropClick(event, 'importURLModal')">
        <div class="modal-content" onclick="event.stopPropagation()" style="max-width: 500px;">
            <div class="modal-title" data-i18n="modal.importURL.title">URL에서 불러오기</div>
            <form onsubmit="submitImportURL(event)">
                <div class="form-group">
                    <label data-i18n="modal.importURL.label">JSON 파일 URL</label>
                    <input type="url" id="importURLInput" placeholder="https://example.com/mindmap.json" required>
                </div>
                <div class="form-group">
                    <small style="color: var(--text-secondary);" data-i18n="modal.importURL.hint">GitHub raw URL, Gist, 또는 직접 접근 가능한 JSON 파일 URL을 입력하세요</small>
                </div>
                <div class="modal-buttons">
                    <button type="button" class="btn btn-secondary" onclick="closeImportURLModal()" data-i18n="modal.edit.cancel">취소</button>
                    <button type="submit" class="btn btn-primary" data-i18n="modal.importURL.load">불러오기</button>
                </div>
            </form>
        </div>
    </div>

    <!-- AI 설정 모달 -->
    <!-- JavaScript 파일들 -->
    <script src="js/config.js"></script>
    <script src="js/i18n.js"></script>
    <script src="js/utils.js"></script>
    <script src="js/canvas.js"></script>
    <script src="js/nodes.js"></script>
    <script src="js/connections.js"></script>
    <script src="js/events.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/history.js"></script>
    <script src="js/export.js"></script>
    <script src="js/storage.js"></script>
    <script src="js/main.js"></script>
</body>
</html>

